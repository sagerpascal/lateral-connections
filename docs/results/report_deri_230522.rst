Status 22 May, 2023
===================

Desired (not Expected) Result
-----------------------------

.. image:: /_static/results/01_desired_result.png
  :width: 400
  :alt: Desired Results

- The activations should capture the characteristics of the object
  - The image should be consistent, similar images (same object at similar location) should have similar activations, different images should have different activations
  - Small differences should not lead to large differences in the activations or can be even smoothed out
- The algorithm should be as simple as possible
- The activations should allow to identify and locate the object
- It would be desirable to have different activations for different features, e.g. for end of line and middle section of line
- Noise should be ignored
- It would be desirable to have different feature combinations for different object, e.g. different channels that are active for horizontal and vertical lines


Dataset
-------

During training, only grayscale images of vertical and horizontal lines were used.
From each image, 10 augmented images were generated by randomly moving the points defining the line by 2 pixels.
Some examples are shown below.

.. image:: /_static/results/02_train_data.png
  :width: 400
  :alt: Training Dataset

During testing, we used 4 pre-defined images and additional random images.
The predefined images consists of a vertical, a horizontal, and two diagonal (slope +/- 45°) lines.
Optionally, random noise was added by setting pixels to 1 with a probability of 0.5%.

.. image:: /_static/results/02_test_data.png
  :width: 400
  :alt: Test Dataset



Experiments
-----------

Run the code with `python s1_toy_example.py --plot --plot_dir <> --test_noise <> --mask_bg --moving_average`.


 ============ ======= ===================== =====================
  Experiment   Noise   Mask out Background     Moving Average
 ============ ======= ===================== =====================
 1               ❌            ❌                   ❌
 2.1 / 2.2       ❌            ❌                    ✅ (V1, V2)
 3               ❌            ✅                   ❌
 4.1 / 4.3       ❌            ✅                    ✅ (V1, V2)
 5               ✅            ❌                   ❌
 6.1 / 6.2       ✅            ❌                    ✅ (V1, V2)
 7               ✅            ✅                   ❌
 8.1 / 8.2       ✅            ✅                    ✅ (V1, V2)
 ============ ======= ===================== =====================

Noise
  Whether to add 0.5% noise to the test images.

Mask out Background
  Whether to mask out the background. With this option, the bias is set to `1/num_channels/50` and the background
  (i.e. the pixels with the smallest value per channel) is set to 0.
  Otherwise, the bias is set to `1/num_channels` and the background is contained in as features in the channels
  (winner-takes-all will always select one channel per pixel as winner).

Moving Average
  Whether to use a moving average to smooth the activations. The moving average is applied to the activations
  for the features that stem from the same image.
  We used two kinds of moving averages: V1 calculates the average as `z[t+1] := 0.7 * z[t+1] + 0.3 + z[t]` over
  all views and timesteps from the same image. V1 calculates the average as `z[t+1] := 0.5 * z[t+1] + 0.5 + z_old[t+1]`,
  thus only uses activations that stem from the same timestep (but different views).


Results
-------

Experiment 1: No noise, no background masking, no moving average
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. video:: ../_static/results/03_01.mp4
   :width: 450

.. video:: ../_static/results/03_02.mp4
   :width: 450

.. video:: ../_static/results/03_03.mp4
   :width: 450

.. video:: ../_static/results/03_04.mp4
   :width: 450


Experiment 2: No noise, no background masking, moving average
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

**Moving Average V1**

.. video:: ../_static/results/04_01.mp4
   :width: 450

.. video:: ../_static/results/04_02.mp4
   :width: 450

.. video:: ../_static/results/04_03.mp4
   :width: 450

.. video:: ../_static/results/04_04.mp4
   :width: 450

**Moving Average V2**

.. video:: ../_static/results/04_01_V2.mp4
   :width: 450

.. video:: ../_static/results/04_02_V2.mp4
   :width: 450

.. video:: ../_static/results/04_03_V2.mp4
   :width: 450

.. video:: ../_static/results/04_04_V2.mp4
   :width: 450

Experiment 3: No noise, background masking, no moving average
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. video:: ../_static/results/05_01.mp4
   :width: 450

.. video:: ../_static/results/05_02.mp4
   :width: 450

.. video:: ../_static/results/05_03.mp4
   :width: 450

.. video:: ../_static/results/05_04.mp4
   :width: 450


Experiment 4: No noise, background masking, moving average
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

**Moving Average V1**

.. video:: ../_static/results/06_01.mp4
   :width: 450

.. video:: ../_static/results/06_02.mp4
   :width: 450

.. video:: ../_static/results/06_03.mp4
   :width: 450

.. video:: ../_static/results/06_04.mp4
   :width: 450

**Moving Average V2**

.. video:: ../_static/results/06_01_V2.mp4
   :width: 450

.. video:: ../_static/results/06_02_V2.mp4
   :width: 450

.. video:: ../_static/results/06_03_V2.mp4
   :width: 450

.. video:: ../_static/results/06_04_V2.mp4
   :width: 450


Experiment 5: Noise, no background masking, no moving average
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. video:: ../_static/results/07_01.mp4
   :width: 450

.. video:: ../_static/results/07_02.mp4
   :width: 450

.. video:: ../_static/results/07_03.mp4
   :width: 450

.. video:: ../_static/results/07_04.mp4
   :width: 450

Experiment 6: Noise, no background masking, moving average
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

**Moving Average V1**

.. video:: ../_static/results/08_01.mp4
   :width: 450

.. video:: ../_static/results/08_02.mp4
   :width: 450

.. video:: ../_static/results/08_03.mp4
   :width: 450

.. video:: ../_static/results/08_04.mp4
   :width: 450

**Moving Average V2**

.. video:: ../_static/results/08_01_V2.mp4
   :width: 450

.. video:: ../_static/results/08_02_V2.mp4
   :width: 450

.. video:: ../_static/results/08_03_V2.mp4
   :width: 450

.. video:: ../_static/results/08_04_V2.mp4
   :width: 450


Experiment 7: Noise, background masking, no moving average
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. video:: ../_static/results/09_01.mp4
   :width: 450

.. video:: ../_static/results/09_02.mp4
   :width: 450

.. video:: ../_static/results/09_03.mp4
   :width: 450

.. video:: ../_static/results/09_04.mp4
   :width: 450

Experiment 8: Noise, background masking, moving average
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

**Moving Average V1**

.. video:: ../_static/results/10_01.mp4
   :width: 450

.. video:: ../_static/results/10_02.mp4
   :width: 450

.. video:: ../_static/results/10_03.mp4
   :width: 450

.. video:: ../_static/results/10_04.mp4
   :width: 450

**Moving Average V2**

.. video:: ../_static/results/10_01_V2.mp4
   :width: 450

.. video:: ../_static/results/10_02_V2.mp4
   :width: 450

.. video:: ../_static/results/10_03_V2.mp4
   :width: 450

.. video:: ../_static/results/10_04_V2.mp4
   :width: 450
